
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>ë†ì¥ & ë°”ë‹¤ & ë¬¼ íŠ¹ì„± ì—…ë°ì´íŠ¸</title>
<style>
  /* ê¸°ë³¸ ì„¤ì • */
  body { margin:0; font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background:#e0f7fa; user-select:none; padding-bottom: 50px; }

  /* ìƒë‹¨ ì •ë³´ë°” */
  header {
    background:#00bcd4; color:white; padding:10px 15px; position:sticky; top:0; z-index:900;
    box-shadow: 0 2px 5px rgba(0,0,0,0.2); display:flex; justify-content:space-between; align-items:center;
  }
  .header-left { display:flex; flex-direction:column; }
  #coins { font-size:22px; font-weight:bold; text-shadow: 1px 1px 2px rgba(0,0,0,0.2); }
  #diffDisplay { font-size:12px; color:#b2ebf2; margin-top:2px; font-weight:bold; }
  #msg { font-size:14px; color:#e0f2f1; max-width: 50%; text-align:right; }

  /* ì»¨íŠ¸ë¡¤ íŒ¨ë„ */
  .control-panel { background:#fff; padding:10px; border-bottom:1px solid #ddd; display:flex; gap:15px; flex-wrap:wrap; justify-content:center; align-items:flex-start; }
  .panel-group { display:flex; gap:5px; flex-wrap:wrap; align-items:center; }
  .group-label { font-weight:bold; font-size:14px; color:#555; margin-right:5px; }

  /* íŠ¹ì„± ì •ë³´ì°½ */
  .trait-info {
    background:#e3f2fd; padding:5px 10px; border-radius:10px; border:1px solid #90caf9;
    font-size:12px; color:#1565c0; display:flex; align-items:center; gap:5px;
  }

  .seed, .item {
    padding:6px 12px; border:1px solid #ccc; cursor:pointer; background:#fafafa; border-radius:15px;
    font-size:13px; transition: all 0.2s;
  }
  .seed:hover, .item:hover { background:#eee; }
  .selected { 
    background:#fff59d !important; border:2px solid #fbc02d !important; 
    font-weight:bold; transform:scale(1.05); box-shadow:0 2px 4px rgba(0,0,0,0.1); 
  }
  
  /* ì‘ë¬¼ë³„ ìŠ¤íƒ€ì¼ */
  .seed[data-type="moneytree"] { background:#f3e5f5; border-color:#ce93d8; color:#6a1b9a; }
  .seed[data-type="clam"] { background:#e1f5fe; border-color:#0288d1; color:#01579b; } 
  .seed[data-type="peach"] { background:#fce4ec; border-color:#f06292; color:#c2185b; } /* ë³µìˆ­ì•„ */

  /* ì•„ì´í…œ ìŠ¤íƒ€ì¼ */
  .item[data-item="diamondwater"] { background:#e0f7fa; border-color:#00acc1; color:#006064; }
  .item[data-item="emeraldwater"] { background:#e8f5e9; border-color:#2e7d32; color:#1b5e20; }

  /* ë©”ì¸ ë ˆì´ì•„ì›ƒ */
  #main-container { display:flex; flex-wrap:wrap; justify-content:center; gap:20px; padding:20px; }

  /* êµ¬ì—­ ë°•ìŠ¤ */
  .area-box { background:white; padding:15px; border-radius:15px; box-shadow:0 4px 10px rgba(0,0,0,0.05); }
  h2.area-title { margin-top:0; text-align:center; color:#333; border-bottom:2px solid #eee; padding-bottom:10px; margin-bottom:15px; }

  /* ë†ì¥ ê·¸ë¦¬ë“œ */
  #farm { display:grid; grid-template-columns:repeat(5, 70px); gap:5px; } 
  @media (min-width: 800px) { #farm { grid-template-columns:repeat(10, 70px); } }

  .tile {
    width:70px; height:70px; background:#c2a878; border:2px solid #8b6f47; border-radius:4px;
    display:flex; justify-content:center; align-items:center; position:relative; cursor:pointer;
  }
  .plant { font-size:35px; z-index:2; }
  .timer { 
    position:absolute; bottom:2px; font-size:10px; color:white;
    background:rgba(0,0,0,0.6); padding:1px 4px; border-radius:4px; pointer-events:none; z-index:3;
  }
  
  /* ë¬¼ íŠ¹ì„± ì•„ì´ì½˜ (ì‘ë¬¼ ìœ„) */
  .trait-icon {
    position:absolute; top:2px; right:2px; font-size:16px; z-index:5;
    animation: bounce 1.5s infinite; filter: drop-shadow(0 0 2px white);
  }
  @keyframes bounce {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-3px); }
  }

  /* í”Œë¡œíŒ… í…ìŠ¤íŠ¸ */
  .float-text {
    position:absolute; color:#ffeb3b; font-weight:bold; font-size:16px; z-index:10;
    text-shadow: 1px 1px 2px black; animation: floatUp 0.8s forwards; pointer-events: none; width: 100%; text-align: center;
  }
  @keyframes floatUp { 0% { transform:translateY(0); opacity:1; } 100% { transform:translateY(-40px); opacity:0; } }

  /* ë™ë¬¼ ë†ì¥ */
  #animalFarm { width: 320px; }
  .pet-section { margin-bottom: 20px; background:#f9f9f9; padding:10px; border-radius:10px; }
  .section-title { font-weight:bold; margin-bottom:5px; color:#555; font-size:14px; }
  
  .pet-stats { display:flex; justify-content:space-around; margin-bottom:10px; }
  .pet-card { text-align:center; font-size:12px; background:#fff; padding:8px 5px; border-radius:8px; border:1px solid #eee; width:30%; box-shadow:0 2px 2px rgba(0,0,0,0.05); }
  .pet-icon { font-size:24px; display:block; margin-bottom:2px; }
  .pet-count { font-weight:bold; color:#009688; font-size:16px; }
  
  .egg-btn {
    width:100%; padding:12px; color:white; border:none; border-radius:8px; font-size:14px; font-weight:bold; cursor:pointer; margin-top:5px;
    transition: transform 0.1s;
  }
  .egg-btn:active { transform:translateY(2px); }
  
  #staticBuyEggBtn { background:#ff9800; box-shadow: 0 4px 0 #e65100; }
  #staticBuySeaEggBtn { background:#2196f3; box-shadow: 0 4px 0 #0d47a1; }

  /* íŒì—… ê³µí†µ */
  .popup {
    position:fixed; top:50%; left:50%; transform:translate(-50%,-50%);
    background:#fff; padding:0; border-radius:15px; z-index:99999;
    width:400px; max-width: 90%; text-align:center; box-shadow: 0 10px 30px rgba(0,0,0,0.4);
    transition: opacity 0.3s, transform 0.3s; overflow: hidden;
  }
  .popup-header { background:#00bcd4; color:white; padding:15px; font-size:20px; font-weight:bold; }
  .popup-content { padding: 20px; }
  .hidden { display:none !important; }
  .fade-out-scale { opacity: 0; transform: translate(-50%, -50%) scale(0.8); pointer-events: none; }

  /* ìƒì  íƒ­ */
  .shop-tabs { display:flex; justify-content:space-around; background:#f0f0f0; border-bottom:1px solid #ddd; }
  .shop-tab { padding:10px 15px; cursor:pointer; font-weight:bold; color:#555; border-bottom:3px solid transparent; width:50%; text-align:center; }
  .shop-tab.active { color:#00bcd4; border-bottom:3px solid #00bcd4; background:white; }
  .tab-content { display:none; }
  .tab-content.active { display:block; }

  /* ë¦¬ìŠ¤íŠ¸ ìŠ¤íƒ€ì¼ */
  .list-container { max-height: 250px; overflow-y: auto; text-align:left; margin-bottom:15px; border:1px solid #eee; border-radius:8px; padding: 5px 0; }
  .shop-item, .inv-item { padding:10px 15px; border-bottom:1px solid #f7f7f7; display:flex; justify-content:space-between; align-items:center; }
  .shop-item:last-child, .inv-item:last-child { border-bottom: none; }

  /* ë²„íŠ¼ */
  .btn-flat { background:#eee; border:none; padding:8px 15px; border-radius:5px; cursor:pointer; font-weight:bold; }
  .btn-buy { background:#00bcd4; color:white; }
  .btn-sell-pearl { background:#e91e63; color:white; animation: pulse 1s infinite; }
  .diff-btn { 
    display:block; width:100%; margin:10px 0; padding:12px; font-size:16px; 
    background:#fff; border:2px solid #ddd; border-radius:8px; cursor:pointer; transition:0.2s;
  }
  .diff-btn:hover { background:#e0f7fa; border-color:#00bcd4; }

  /* í« ê°œë´‰ ë²„íŠ¼ ê·¸ë£¹ */
  .hatch-btn-group button { margin-left: 3px; font-size:11px; padding: 4px 6px; }
  .btn-sea { background:#2196f3; color:white; }
  .btn-land { background:#ff9800; color:white; }

  /* í« ê°œë´‰ ì• ë‹ˆë©”ì´ì…˜ ì°½ */
  #hatchWindow { z-index: 999999; background: linear-gradient(135deg, #e3f2fd, #fff); border: 5px solid #0288d1; }
  .egg-hatch-animation { animation: pulse 0.5s infinite alternate, shine 1s; background:radial-gradient(circle, rgba(255,255,255,0.9) 0%, rgba(255,255,255,0) 70%); padding:20px; border-radius:15px; }
  @keyframes pulse { from { transform: scale(1); } to { transform: scale(1.05); } }
  @keyframes shine { 0% { box-shadow: 0 0 10px #03a9f4; } 50% { box-shadow: 0 0 40px #03a9f4, 0 0 20px #81d4fa; } 100% { box-shadow: 0 0 10px #03a9f4; } }
  .hatch-result-text { font-size:30px; font-weight:bold; color:#01579b; text-shadow:2px 2px #fff; margin-top:10px; }

  /* ë©”ë‰´ ë²„íŠ¼ */
  #inventoryBtn, #shopBtn {
    position:fixed; right:20px; width:50px; height:50px; border-radius:50%;
    background:white; cursor:pointer; border:2px solid #ccc; font-size:20px;
    z-index:1000000; box-shadow:0 4px 6px rgba(0,0,0,0.2); display:flex; justify-content:center; align-items:center;
  }
  #shopBtn { bottom:80px; background:#e1f5fe; color:#0288d1; border-color:#03a9f4; }
  #inventoryBtn { bottom:20px; background:#fff3e0; color:#e64a19; border-color:#ff9800; }
</style>
</head>
<body>

<header>
  <div class="header-left">
    <div id="coins">ğŸ’° 0</div>
    <div id="diffDisplay">ë‚œì´ë„: ë¯¸ì„ íƒ</div>
  </div>
  <div id="msg">í™˜ì˜í•©ë‹ˆë‹¤!</div>
</header>

<button id="shopBtn" title="ìƒì ">ğŸ›’</button>
<button id="inventoryBtn" title="ì¸ë²¤í† ë¦¬">ğŸ’</button>

<!-- ë‚œì´ë„ ì„ íƒ -->
<div id="difficultyWindow" class="popup">
  <div class="popup-header">ğŸ® ë‚œì´ë„ ì„ íƒ</div>
  <div class="popup-content">
    <button class="diff-btn" data-diff="easy" data-name="ì‰¬ì›€">ğŸ™‚ ì‰¬ì›€ (500ì½”ì¸)</button>
    <button class="diff-btn" data-diff="normal" data-name="ë³´í†µ">ğŸ˜ ë³´í†µ (300ì½”ì¸)</button>
    <button class="diff-btn" data-diff="hard" data-name="ì–´ë ¤ì›€">ğŸ˜« ì–´ë ¤ì›€ (150ì½”ì¸)</button>
    <button class="diff-btn" data-diff="admin" data-name="ê´€ë¦¬ì">âš¡ ê´€ë¦¬ì (ë¬´í•œ)</button>
  </div>
</div>

<!-- í« ê°œë´‰ ì• ë‹ˆë©”ì´ì…˜ ì°½ -->
<div id="hatchWindow" class="popup hidden">
  <h2>í« ë¶€í™”!</h2>
  <div class="egg-hatch-animation">
    <div id="hatchIcon" style="font-size:80px;">ğŸ¥š</div>
  </div>
  <div class="hatch-result-text" id="hatchName">...</div>
  <div style="font-size:14px; margin-top:5px; color:#555;" id="hatchSummary"></div>
  <button class="diff-btn" style="margin-top:20px;" onclick="document.getElementById('hatchWindow').classList.add('hidden')">í™•ì¸</button>
</div>

<!-- ì»¨íŠ¸ë¡¤ íŒ¨ë„ -->
<div class="control-panel">
  <div class="trait-info" title="ì‘ë¬¼ì„ ì‹¬ì„ ë•Œ 20% í™•ë¥ ë¡œ ë¶€ì—¬ë¨">
    <span>ğŸ’¡ íŠ¹ì„± ì •ë³´: </span>
    <span>ğŸ’§ = íŒë§¤ê°€ 3ë°°!</span>
  </div>
  <div class="panel-group">
    <span class="group-label">ğŸŒ± ì”¨ì•—:</span>
    <div id="seeds" style="display:flex; gap:5px;"></div>
  </div>
  <div class="panel-group">
    <span class="group-label">ğŸ›  ë„êµ¬:</span>
    <div id="items" style="display:flex; gap:5px;">
      <div class="item" data-item="water">ğŸ’§ ë¬¼(5ë¶„)</div>
      <div class="item" data-item="goldwater">âœ¨ í™©ê¸ˆ(25ë¶„)</div>
      <div class="item" data-item="diamondwater">ğŸ’ ë‹¤ì´ì•„(45ë¶„)</div>
      <div class="item" data-item="emeraldwater">ğŸ’š ì—ë©”ë„ë“œ(120ë¶„)</div>
    </div>
  </div>
</div>

<!-- ë©”ì¸ ì˜ì—­ -->
<div id="main-container">
  
  <div class="area-box">
    <h2 class="area-title">ğŸŒ½ ë†ì¥</h2>
    <div id="farm"></div>
  </div>

  <div class="area-box" id="animalFarm">
    <h2 class="area-title">ğŸ¾ ë™ë¬¼ ë†ì¥</h2>
    
    <!-- ìœ¡ì§€ ë™ë¬¼ -->
    <div class="pet-section">
      <div class="section-title">ğŸï¸ ìœ¡ì§€ ë™ë¬¼</div>
      <div class="pet-stats">
        <div class="pet-card"><span class="pet-icon">ğŸ¶</span><div>ì„±ì¥+5%</div><div class="pet-count" id="cnt_dog">0</div></div>
        <div class="pet-card"><span class="pet-icon">ğŸ±</span><div>+1000/10ì´ˆ</div><div class="pet-count" id="cnt_cat">0</div></div>
        <div class="pet-card"><span class="pet-icon">ğŸ¸</span><div>5ë¶„ ê¸‰ì„±ì¥</div><div class="pet-count" id="cnt_frog">0</div></div>
      </div>
      <button id="staticBuyEggBtn" class="egg-btn">ğŸ¥š ìœ¡ì§€ ì•Œ êµ¬ë§¤ (100ì½”ì¸)</button>
    </div>

    <!-- ë°”ë‹¤ ë™ë¬¼ -->
    <div class="pet-section" style="background:#e3f2fd;">
      <div class="section-title">ğŸŒŠ ë°”ë‹¤ ë™ë¬¼</div>
      <div class="pet-stats">
        <div class="pet-card"><span class="pet-icon">ğŸ¦­</span><div>íŒë§¤ê°€+5%</div><div class="pet-count" id="cnt_seal">0</div></div>
        <div class="pet-card"><span class="pet-icon">ğŸ¦€</span><div>í…œ ì¤ê¸°</div><div class="pet-count" id="cnt_crab">0</div></div>
        <div class="pet-card"><span class="pet-icon">ğŸ¦ˆ</span><div>2ë°° íšë“</div><div class="pet-count" id="cnt_shark">0</div></div>
      </div>
      <button id="staticBuySeaEggBtn" class="egg-btn">ğŸ”µ ë°”ë‹¤ ì•Œ êµ¬ë§¤ (500ì½”ì¸)</button>
    </div>

  </div>

</div>

<!-- ìƒì  íŒì—… -->
<div id="shopWindow" class="popup hidden">
  <div class="popup-header">ğŸª ìƒì </div>
  <div class="shop-tabs">
    <div class="shop-tab active" data-tab="seeds-tab">ğŸŒ± ì”¨ì•—/ì•Œ</div>
    <div class="shop-tab" data-tab="items-tab">ğŸ›  ì•„ì´í…œ</div>
  </div>
  <div class="popup-content">
    <div class="tab-content active" id="seeds-tab">
      <div class="list-container" id="shopSeedList"></div>
    </div>
    <div class="tab-content" id="items-tab">
      <div class="list-container" id="shopItemList"></div>
    </div>
    <button id="closeShop" class="diff-btn">ë‹«ê¸°</button>
  </div>
</div>

<!-- ì¸ë²¤í† ë¦¬ íŒì—… -->
<div id="inventoryWindow" class="popup hidden">
  <div class="popup-header">ğŸ’ ì¸ë²¤í† ë¦¬</div>
  <div class="popup-content">
    <div class="list-container">
      
      <!-- ë³´ë¬¼(ì§„ì£¼) -->
      <div class="inv-item" id="pearlInvItem" style="display:none; background:#fce4ec;">
        <div>ğŸ”® <b>ì§„ì£¼</b>: <span id="inv_pearl">0</span>ê°œ</div>
        <button class="btn-flat btn-sell-pearl" id="sellPearlBtn">1ê°œ íŒë§¤ (10ë§Œ)</button>
      </div>

      <!-- ìœ¡ì§€ ì•Œ -->
      <div class="inv-item">
        <div>ğŸ¥š <b>ìœ¡ì§€ ì•Œ</b>: <span id="inv_egg">0</span>ê°œ</div>
        <div class="hatch-btn-group">
          <button class="btn-flat btn-land hatchEggBtn" data-type="land" data-count="1">1ê°œ</button>
          <button class="btn-flat btn-land hatchEggBtn" data-type="land" data-count="3">3ê°œ</button>
          <button class="btn-flat btn-land hatchEggBtn" data-type="land" data-count="10">10ê°œ</button>
        </div>
      </div>

      <!-- ë°”ë‹¤ ì•Œ -->
      <div class="inv-item" style="background:#e1f5fe;">
        <div>ğŸ”µ <b>ë°”ë‹¤ ì•Œ</b>: <span id="inv_seaEgg">0</span>ê°œ</div>
        <div class="hatch-btn-group">
          <button class="btn-flat btn-sea hatchEggBtn" data-type="sea" data-count="1">1ê°œ</button>
          <button class="btn-flat btn-sea hatchEggBtn" data-type="sea" data-count="3">3ê°œ</button>
          <button class="btn-flat btn-sea hatchEggBtn" data-type="sea" data-count="10">10ê°œ</button>
        </div>
      </div>

      <hr>
      <div class="inv-item">ğŸ’§ ë¬¼ë¿Œë¦¬ê°œ: <span id="inv_water">0</span></div>
      <div class="inv-item">âœ¨ í™©ê¸ˆ ë¬¼ë¿Œë¦¬ê°œ: <span id="inv_goldwater">0</span></div>
      <div class="inv-item">ğŸ’ ë‹¤ì´ì•„ ë¬¼ë¿Œë¦¬ê°œ: <span id="inv_diamondwater">0</span></div>
      <div class="inv-item">ğŸ’š ì—ë©”ë„ë“œ ë¬¼ë¿Œë¦¬ê°œ: <span id="inv_emeraldwater">0</span></div>
      <hr>
      <div id="inventorySeedList"></div>
    </div>
    <button id="closeInv" class="diff-btn">ë‹«ê¸°</button>
  </div>
</div>

<script>
window.addEventListener('DOMContentLoaded', () => {

  // ========================
  // 1. ë°ì´í„° ì„¤ì •
  // ========================
  let coins = 0;
  let growSpeed = 1; 
  let currentDiffName = "ë¯¸ì„ íƒ";
  
  const petInfo = {
    dog: { name: "ê°•ì•„ì§€", icon: "ğŸ¶", desc: "ì„±ì¥ ì†ë„ 5% â†‘" },
    cat: { name: "ê³ ì–‘ì´", icon: "ğŸ±", desc: "10ì´ˆë§ˆë‹¤ 1,000ì½”ì¸" },
    frog: { name: "ê°œêµ¬ë¦¬", icon: "ğŸ¸", desc: "5ë¶„ë§ˆë‹¤ ê¸‰ì„±ì¥" },
    seal: { name: "ë¬¼ê°œ", icon: "ğŸ¦­", desc: "íŒë§¤ ê°€ê²© 5% â†‘" },
    crab: { name: "ê½ƒê²Œ", icon: "ğŸ¦€", desc: "10% í™•ë¥ ë¡œ ì•„ì´í…œ" },
    shark: { name: "ìƒì–´", icon: "ğŸ¦ˆ", desc: "20% í™•ë¥ ë¡œ 2ë°° ì½”ì¸" }
  };
  
  let pets = { dog: 0, cat: 0, frog: 0, seal: 0, crab: 0, shark: 0 }; 

  const plantInfo = {
    potato:   {name:"ê°ì", cost:10,  sell:15,  grow:2*60000,  stages:["ğŸŒ±","ğŸŒ¿","ğŸ¥”"]},
    tomato:   {name:"í† ë§ˆí† ", cost:30,  sell:45,  grow:5*60000,  stages:["ğŸŒ±","ğŸŒ¿","ğŸ…"]},
    tulip:    {name:"íŠ¤ë¦½", cost:50,  sell:80,  grow:10*60000, stages:["ğŸŒ±","ğŸŒ¿","ğŸŒ·"]},
    wheat:    {name:"ë°€",   cost:100, sell:150, grow:15*60000, stages:["ğŸŒ±","ğŸŒ¿","ğŸŒ¾"]},
    pumpkin:  {name:"í˜¸ë°•", cost:150, sell:230, grow:20*60000, stages:["ğŸŒ±","ğŸŒ¿","ğŸƒ"]},
    persimmon:{name:"í™ì‹œ", cost:200, sell:320, grow:30*60000, stages:["ğŸŒ±","ğŸŒ¿","ğŸŠ"]},
    mango:    {name:"ë§ê³ ", cost:300, sell:500, grow:45*60000, stages:["ğŸŒ±","ğŸŒ¿","ğŸ¥­"]},
    // ë³µìˆ­ì•„ ì¶”ê°€
    peach:    {name:"ğŸ‘ë³µìˆ­ì•„", cost:500, sell:666, grow:50*60000, stages:["ğŸŒ±","ğŸŒ¿","ğŸ‘"]},
    clam:     {name:"ğŸšì¡°ê°œ", cost:444, sell:555, grow:44*60000, stages:["ğŸ’§","ğŸš","âœ¨ğŸš"], isSpecial:true},
    moneytree:{name:"ğŸ’°ëˆë‚˜ë¬´", cost:100000, sell:0, grow:60*60000, stages:["ğŸŒ±","ğŸŒ³","ğŸ’°"], isSpecial:true} 
  };

  const itemInfo = {
    water:       {name:"ë¬¼ë¿Œë¦¬ê°œ", cost:100, reduce:5*60000},
    goldwater:   {name:"í™©ê¸ˆë¬¼ë¿Œë¦¬ê°œ", cost:250, reduce:25*60000},
    diamondwater:{name:"ë‹¤ì´ì•„ë¬¼ë¿Œë¦¬ê°œ", cost:500, reduce:45*60000},
    emeraldwater:{name:"ì—ë©”ë„ë“œë¬¼", cost:1000, reduce:120*60000} 
  };

  let inventory = { egg:0, seaEgg:0, pearl:0, water:0, goldwater:0, diamondwater:0, emeraldwater:0 };
  for(let key in plantInfo) inventory[key] = 0;

  let selectedSeed = "potato";
  let selectedItem = null;

  // ========================
  // 2. ì´ˆê¸°í™” ë° UI ìƒì„±
  // ========================
  
  // ì”¨ì•— ë²„íŠ¼
  const seedContainer = document.getElementById("seeds");
  for(let key in plantInfo){
    const div = document.createElement("div");
    div.className = "seed";
    if(key === "potato") div.classList.add("selected");
    div.dataset.type = key;
    div.textContent = plantInfo[key].name;
    
    div.onclick = () => {
      if(selectedSeed === key) selectedSeed = null;
      else { selectedSeed = key; selectedItem = null; }
      updateSelectionUI();
    };
    seedContainer.appendChild(div);
  }

  // ì•„ì´í…œ ë²„íŠ¼
  document.querySelectorAll(".item").forEach(btn => {
    btn.onclick = () => {
      const clickedItem = btn.dataset.item;
      if(selectedItem === clickedItem) selectedItem = null;
      else { selectedItem = clickedItem; selectedSeed = null; }
      updateSelectionUI();
    };
  });

  function updateSelectionUI(){
    document.querySelectorAll(".seed").forEach(el => {
      el.classList.toggle("selected", el.dataset.type === selectedSeed);
    });
    document.querySelectorAll(".item").forEach(el => {
      el.classList.toggle("selected", el.dataset.item === selectedItem);
    });
  }

  // ìƒì  ëª©ë¡
  const shopSeedList = document.getElementById("shopSeedList");
  for(let key in plantInfo){
    const p = plantInfo[key];
    shopSeedList.innerHTML += `<div class="shop-item"><span>${p.name} (ê°€ê²©: ${p.cost.toLocaleString()})</span><button class="btn-flat btn-buy buySeedBtn" data-seed="${key}">êµ¬ë§¤</button></div>`;
  }
  shopSeedList.innerHTML += `<div class="shop-item" style="background:#fff3e0;"><span>ğŸ¥š **ìœ¡ì§€ ì•Œ** (100ì½”ì¸)</span><button class="btn-flat btn-buy buyEggBtn">êµ¬ë§¤</button></div>`;
  shopSeedList.innerHTML += `<div class="shop-item" style="background:#e1f5fe;"><span>ğŸ”µ **ë°”ë‹¤ ì•Œ** (500ì½”ì¸)</span><button class="btn-flat btn-sea buySeaEggBtn">êµ¬ë§¤</button></div>`;

  const shopItemList = document.getElementById("shopItemList");
  for(let key in itemInfo){
    const item = itemInfo[key];
    shopItemList.innerHTML += `<div class="shop-item"><span>${item.name} (${item.cost}ì½”ì¸)</span><button class="btn-flat btn-buy buyItemBtn" data-item="${key}">êµ¬ë§¤</button></div>`;
  }

  // ì¸ë²¤í† ë¦¬ ì”¨ì•— ëª©ë¡
  const invSeedList = document.getElementById("inventorySeedList");
  for(let key in plantInfo){
    const div = document.createElement("div");
    div.className = "inv-item";
    div.innerHTML = `${plantInfo[key].name}: <span id="inv_${key}">0</span>`;
    invSeedList.appendChild(div);
  }

  // ë†ì¥ íƒ€ì¼
  const farm = document.getElementById("farm");
  for(let i=0; i<50; i++){
    const t = document.createElement("div");
    t.className = "tile";
    t.onclick = () => onTileClick(t);
    farm.appendChild(t);
  }

  // ========================
  // 3. íŒì—… ë° ì´ë²¤íŠ¸ ì²˜ë¦¬
  // ========================

  const diffWindow = document.getElementById("difficultyWindow");
  document.querySelectorAll(".diff-btn").forEach(btn => {
    btn.addEventListener('click', () => {
      if(btn.id === "closeShop" || btn.id === "closeInv") return; 

      const diff = btn.dataset.diff;
      currentDiffName = btn.dataset.name;
      
      if(diff === "easy") coins = 500;
      else if(diff === "normal") coins = 300;
      else if(diff === "hard") coins = 150;
      else if(diff === "admin") { coins = 999999999; growSpeed = 50; }

      updateCoinDisplay();
      document.getElementById("diffDisplay").textContent = `ë‚œì´ë„: ${currentDiffName}`;

      diffWindow.classList.add("fade-out-scale");
      setTimeout(() => {
        diffWindow.classList.add("hidden");
        diffWindow.classList.remove("fade-out-scale");
      }, 300);
    });
  });

  document.querySelectorAll(".shop-tab").forEach(tab => {
    tab.onclick = function() {
      document.querySelectorAll(".shop-tab").forEach(t => t.classList.remove("active"));
      this.classList.add("active");
      document.querySelectorAll(".tab-content").forEach(c => c.classList.remove("active"));
      document.getElementById(this.dataset.tab).classList.add("active");
    };
  });

  // ========================
  // 4. ì•Œ / ì§„ì£¼ / ì•„ì´í…œ ë¡œì§
  // ========================
  
  function buyEgg(type) {
    if(type === 'sea'){
        if(coins < 500){ showMsg("ì½”ì¸ì´ ë¶€ì¡±í•©ë‹ˆë‹¤ (500ì½”ì¸)"); return; }
        coins -= 500;
        inventory.seaEgg++;
        showMsg("ğŸ”µ ë°”ë‹¤ ì•Œ êµ¬ë§¤ ì™„ë£Œ!");
    } else {
        if(coins < 100){ showMsg("ì½”ì¸ì´ ë¶€ì¡±í•©ë‹ˆë‹¤ (100ì½”ì¸)"); return; }
        coins -= 100;
        inventory.egg++;
        showMsg("ğŸ¥š ìœ¡ì§€ ì•Œ êµ¬ë§¤ ì™„ë£Œ!");
    }
    updateCoinDisplay();
    updateInventoryUI();
  }

  document.getElementById("staticBuyEggBtn").onclick = () => buyEgg('land');
  document.getElementById("staticBuySeaEggBtn").onclick = () => buyEgg('sea');

  document.querySelectorAll(".hatchEggBtn").forEach(btn => {
    btn.onclick = function() {
      const count = Number(this.dataset.count);
      const type = this.dataset.type; 
      hatchEggs(type, count);
    };
  });

  function hatchEggs(type, count){
    const invKey = (type === 'sea') ? 'seaEgg' : 'egg';
    if(inventory[invKey] < count){ showMsg(`ì•Œì´ ${count}ê°œ ë¶€ì¡±í•©ë‹ˆë‹¤.`); return; }

    inventory[invKey] -= count;
    
    const results = {};
    for(let i=0; i<count; i++){
      const r = Math.random();
      let petKey = "";
      
      if(type === 'sea'){
        if(r < 0.50) petKey = "seal";
        else if(r < 0.80) petKey = "crab";
        else petKey = "shark";
      } else {
        if(r < 0.80) petKey = "dog";
        else if(r < 0.95) petKey = "cat";
        else petKey = "frog";
      }
      
      pets[petKey]++;
      results[petKey] = (results[petKey] || 0) + 1;
    }

    updatePetUI();
    updateInventoryUI();
    
    let mostKey = Object.keys(results)[0]; 
    let maxVal = -1;
    for(let k in results){
        if(results[k] > maxVal){ maxVal = results[k]; mostKey = k; }
    }
    let pet = petInfo[mostKey];

    const hatchWindow = document.getElementById("hatchWindow");
    const hatchIcon = document.getElementById("hatchIcon");
    const hatchName = document.getElementById("hatchName");
    const hatchSummary = document.getElementById("hatchSummary");
    
    hatchIcon.textContent = (type==='sea') ? "ğŸ”µ" : "ğŸ¥š";
    hatchName.textContent = "ë¶€í™”ì¤‘...";
    hatchSummary.textContent = `${count}ê°œì˜ ì•Œì—ì„œ...`;
    hatchWindow.classList.remove("hidden");

    setTimeout(() => {
      const summaryArr = [];
      for(let k in results) {
          if(results[k]>0) summaryArr.push(`${petInfo[k].icon}x${results[k]}`);
      }
      
      hatchIcon.textContent = pet.icon;
      hatchName.textContent = `${count}ê°œ ê°œë´‰!`;
      hatchSummary.textContent = summaryArr.join(' | ');
      hatchIcon.classList.add("egg-hatch-animation");

      showMsg(`ğŸŠ ${count}ê°œ ì•Œ ê°œë´‰ ì™„ë£Œ!`);
      setTimeout(() => hatchIcon.classList.remove("egg-hatch-animation"), 1000);
    }, 500); 
  }

  // ì§„ì£¼ íŒë§¤
  document.getElementById("sellPearlBtn").onclick = () => {
    if(inventory.pearl > 0){
        inventory.pearl--;
        coins += 100000;
        updateCoinDisplay();
        updateInventoryUI();
        showMsg("ğŸ”® ì§„ì£¼ë¥¼ 100,000ì½”ì¸ì— íŒë§¤í–ˆìŠµë‹ˆë‹¤!");
    } else {
        showMsg("íŒë§¤í•  ì§„ì£¼ê°€ ì—†ìŠµë‹ˆë‹¤.");
    }
  };

  // ========================
  // 5. ì—…ë°ì´íŠ¸ & í« íš¨ê³¼
  // ========================

  function updatePetUI(){
    document.getElementById("cnt_dog").textContent = pets.dog;
    document.getElementById("cnt_cat").textContent = pets.cat;
    document.getElementById("cnt_frog").textContent = pets.frog;
    document.getElementById("cnt_seal").textContent = pets.seal;
    document.getElementById("cnt_crab").textContent = pets.crab;
    document.getElementById("cnt_shark").textContent = pets.shark;
  }
  
  function updateCoinDisplay(){
    document.getElementById("coins").textContent = `ğŸ’° ${coins.toLocaleString()}`;
  }

  function showMsg(txt){
    const msg = document.getElementById("msg");
    msg.textContent = txt;
    setTimeout(()=> msg.textContent="...", 3000);
  }

  function updateInventoryUI(){
    document.getElementById("inv_egg").textContent = inventory.egg;
    document.getElementById("inv_seaEgg").textContent = inventory.seaEgg;
    document.getElementById("inv_water").textContent = inventory.water;
    document.getElementById("inv_goldwater").textContent = inventory.goldwater;
    document.getElementById("inv_diamondwater").textContent = inventory.diamondwater;
    document.getElementById("inv_emeraldwater").textContent = inventory.emeraldwater; 
    
    document.getElementById("inv_pearl").textContent = inventory.pearl;
    const pearlItem = document.getElementById("pearlInvItem");
    if(inventory.pearl > 0) pearlItem.style.display = "flex";
    else pearlItem.style.display = "none";

    for(let key in plantInfo){
      const el = document.getElementById(`inv_${key}`);
      if(el) el.textContent = inventory[key];
    }
    
    document.querySelectorAll(".hatchEggBtn").forEach(btn => {
      const invKey = (btn.dataset.type === 'sea') ? 'seaEgg' : 'egg';
      if(inventory[invKey] < Number(btn.dataset.count)) {
        btn.style.opacity = "0.5"; btn.style.cursor = "not-allowed";
      } else {
        btn.style.opacity = "1"; btn.style.cursor = "pointer";
      }
    });
  }

  function showFloatText(element, text, color){
    const float = document.createElement("div");
    float.className = "float-text";
    float.textContent = text;
    if(color) float.style.color = color;
    element.appendChild(float);
    setTimeout(()=>float.remove(), 800);
  }

  function clearTile(tile){
    tile.innerHTML = "";
    tile.dataset.plant = "";
    tile.dataset.trait = ""; // íŠ¹ì„± ì´ˆê¸°í™”
    tile.removeAttribute("data-time");
    tile.removeAttribute("data-touches");
  }

  // [í«] ê³ ì–‘ì´
  setInterval(() => {
    if(pets.cat > 0){
      const gain = pets.cat * 1000;
      coins += gain;
      updateCoinDisplay();
      showMsg(`ğŸ± ê³ ì–‘ì´ê°€ ${gain} ì½”ì¸ì„ ì°¾ì•„ì™”ì–´ìš”!`);
    }
  }, 10000); 

  // [í«] ê°œêµ¬ë¦¬
  setInterval(() => {
    if(pets.frog > 0){
      for(let i=0; i<pets.frog; i++){
        const growingTiles = [];
        document.querySelectorAll(".tile").forEach(t => {
          if(t.dataset.plant && Number(t.dataset.time) > Date.now()) {
            growingTiles.push(t);
          }
        });
        if(growingTiles.length > 0){
          const luckyTile = growingTiles[Math.floor(Math.random() * growingTiles.length)];
          luckyTile.dataset.time = Date.now();
          showFloatText(luckyTile, "ğŸ¸ ê¸‰ì„±ì¥!");
          showMsg("ğŸ¸ ê°œêµ¬ë¦¬ê°€ ì‘ë¬¼ì„ ê¸‰ì„±ì¥ì‹œì¼°ìŠµë‹ˆë‹¤!");
        }
      }
    }
  }, 5 * 60 * 1000);


  // ========================
  // 6. íƒ€ì¼ í´ë¦­ ë¡œì§
  // ========================

  function onTileClick(tile){
    const plantType = tile.dataset.plant;

    // ì•„ì´í…œ ì‚¬ìš©
    if(selectedItem && plantType){
      if(inventory[selectedItem] <= 0){ showMsg("ì•„ì´í…œì´ ì—†ìŠµë‹ˆë‹¤!"); return; }
      inventory[selectedItem]--; updateInventoryUI();
      let endTime = Number(tile.dataset.time);
      endTime -= itemInfo[selectedItem].reduce;
      if(endTime < Date.now()) endTime = Date.now();
      tile.dataset.time = endTime;
      showFloatText(tile, "ì‹œê°„ ë‹¨ì¶•! â³");
      return;
    }

    // ìˆ˜í™•
    if(plantType){
      if(Date.now() >= Number(tile.dataset.time)){
        
        // ëˆë‚˜ë¬´
        if(plantType === 'moneytree'){
            let touches = Number(tile.dataset.touches || 0);
            const gain = Math.floor(Math.random() * 9001) + 1000;
            coins += gain; updateCoinDisplay();
            showFloatText(tile, `+${gain}`);
            touches++; tile.dataset.touches = touches;
            if(touches >= 3) clearTile(tile);
            else { tile.style.transform = "scale(0.9)"; setTimeout(()=>tile.style.transform="scale(1)", 100); }
            return;
        }

        // --- ì¡°ê°œ ì§„ì£¼ ---
        if(plantType === 'clam'){
            if(Math.random() < 0.01){
                inventory.pearl++;
                updateInventoryUI();
                showMsg("âœ¨ ëŒ€ë°•! ì¡°ê°œì—ì„œ ì§„ì£¼ë¥¼ ë°œê²¬í–ˆìŠµë‹ˆë‹¤!");
                showFloatText(tile, "ğŸ”® ì§„ì£¼ íšë“!", "#e91e63");
            }
        }

        let sellPrice = plantInfo[plantType].sell;

        // [ë¬¼ íŠ¹ì„±] 3ë°° ì ìš©
        if(tile.dataset.trait === "water"){
            sellPrice *= 3;
        }

        // [í«] ë¬¼ê°œ
        if(pets.seal > 0){
            sellPrice = Math.floor(sellPrice * (1 + pets.seal * 0.05));
        }

        // [í«] ìƒì–´
        let isCrit = false;
        if(pets.shark > 0){
             if(Math.random() < (pets.shark * 0.2)){
                 sellPrice *= 2;
                 isCrit = true;
             }
        }

        coins += sellPrice; 
        updateCoinDisplay();
        
        let visualText = `+${sellPrice}`;
        if(isCrit) visualText = `ğŸ¦ˆ ${visualText}`;
        if(tile.dataset.trait === "water") visualText = `ğŸ’§3ë°°! ${visualText}`;
        
        showFloatText(tile, visualText, isCrit ? "#ff1744" : "#ffeb3b");

        // [í«] ê½ƒê²Œ
        if(pets.crab > 0){
            for(let i=0; i<pets.crab; i++){
                if(Math.random() < 0.1){
                    inventory.water++;
                    showMsg("ğŸ¦€ ê½ƒê²Œê°€ ë¬¼ë¿Œë¦¬ê°œë¥¼ ì£¼ì› ìŠµë‹ˆë‹¤!");
                    updateInventoryUI();
                    break; 
                }
            }
        }

        clearTile(tile);
      } else { showMsg("ì•„ì§ ìë¼ëŠ” ì¤‘ì…ë‹ˆë‹¤ ğŸŒ±"); }
      return;
    }

    // ì‹¬ê¸°
    if(selectedSeed){
      if(inventory[selectedSeed] > 0){
        inventory[selectedSeed]--; updateInventoryUI();
        
        const speedMultiplier = 1 + (pets.dog * 0.05);
        const baseGrowTime = plantInfo[selectedSeed].grow / growSpeed;
        const realGrowTime = baseGrowTime / speedMultiplier;

        tile.dataset.plant = selectedSeed;
        tile.dataset.time = Date.now() + realGrowTime;
        if(selectedSeed === 'moneytree') tile.dataset.touches = 0;

        // ë¬¼ íŠ¹ì„± (Water Trait) ë¶€ì—¬: 20% í™•ë¥ 
        let traitHTML = "";
        if(Math.random() < 0.20){
            tile.dataset.trait = "water";
            traitHTML = `<div class="trait-icon">ğŸ’§</div>`;
        } else {
            tile.dataset.trait = "";
        }

        const initialIcon = (selectedSeed==='clam') ? "ğŸ’§" : "ğŸŒ±";
        tile.innerHTML = `<div class="plant">${initialIcon}</div>${traitHTML}<div class="timer">ì¤€ë¹„ì¤‘</div>`;
      } else { showMsg("ì”¨ì•—ì´ ë¶€ì¡±í•©ë‹ˆë‹¤!"); document.getElementById("shopWindow").classList.remove("hidden"); }
    }
  }

  // ì„±ì¥ ë£¨í”„
  setInterval(() => {
    document.querySelectorAll(".tile").forEach(tile => {
      const type = tile.dataset.plant;
      if(!type) return;

      const endTime = Number(tile.dataset.time);
      const timeLeft = endTime - Date.now();
      
      const plantDiv = tile.querySelector(".plant");
      const timerDiv = tile.querySelector(".timer");

      if(plantDiv){
        if(timeLeft <= 0) plantDiv.textContent = plantInfo[type].stages[2];
        else if(timeLeft < (plantInfo[type].grow/growSpeed)/2) plantDiv.textContent = plantInfo[type].stages[1];
        else plantDiv.textContent = plantInfo[type].stages[0];
      }

      if(timerDiv){
        if(timeLeft <= 0){
          const text = (type === 'moneytree') ? `í„°ì¹˜: ${3 - (Number(tile.dataset.touches)||0)}` : "ìˆ˜í™•!";
          timerDiv.textContent = text;
          timerDiv.style.background = (type === 'moneytree') ? "#9c27b0" : "#4caf50";
        } else {
          const s = Math.ceil(timeLeft / 1000);
          timerDiv.textContent = s > 60 ? `${Math.ceil(s/60)}ë¶„` : `${s}ì´ˆ`;
          timerDiv.style.background = "rgba(0,0,0,0.6)";
        }
      }
    });
  }, 200);


  // ìƒì /ì¸ë²¤ ë²„íŠ¼
  document.getElementById("shopBtn").onclick = () => document.getElementById("shopWindow").classList.remove("hidden");
  document.getElementById("closeShop").onclick = () => document.getElementById("shopWindow").classList.add("hidden");
  document.getElementById("inventoryBtn").onclick = () => {
    updateInventoryUI();
    document.getElementById("inventoryWindow").classList.remove("hidden");
  };
  document.getElementById("closeInv").onclick = () => document.getElementById("inventoryWindow").classList.add("hidden");

  // êµ¬ë§¤ ë¡œì§
  document.getElementById("shopWindow").addEventListener("click", (e) => {
    if(e.target.classList.contains("buyItemBtn")){
      const itemKey = e.target.dataset.item;
      const cost = itemInfo[itemKey].cost;
      if(coins >= cost){
        coins -= cost; inventory[itemKey]++;
        updateCoinDisplay(); updateInventoryUI();
        showMsg(`${itemInfo[itemKey].name} êµ¬ë§¤ ì™„ë£Œ`);
      } else showMsg("ì½”ì¸ ë¶€ì¡±");
    }
    if(e.target.classList.contains("buySeedBtn")){
      const seedKey = e.target.dataset.seed;
      const cost = plantInfo[seedKey].cost;
      if(coins >= cost){
        coins -= cost; inventory[seedKey]++;
        updateCoinDisplay(); updateInventoryUI();
        showMsg(`${plantInfo[seedKey].name} ì”¨ì•— êµ¬ë§¤ ì™„ë£Œ`);
      } else showMsg("ì½”ì¸ ë¶€ì¡±");
    }
    if(e.target.classList.contains("buyEggBtn")) buyEgg('land');
    if(e.target.classList.contains("buySeaEggBtn")) buyEgg('sea');
  });

});
</script>
</body>
</html>
